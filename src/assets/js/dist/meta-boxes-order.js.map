{"version":3,"file":"meta-boxes-order.js","mappings":"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","sources":["webpack://simple-secure-stripe/./src/assets/js/admin/meta-boxes-order.js"],"sourcesContent":["(function ($) {\n    if (typeof sswps_order_metabox_params === 'undefined') {\n        return;\n    }\n\n    /**\n     * @constructor\n     */\n    function MetaBox() {\n        this.params = sswps_order_metabox_params;\n        this.initialize();\n    }\n\n    MetaBox.prototype.initialize = function () {\n        $(document.body).on('click', '.do-stripe-transaction-view', this.render_charge_view.bind(this))\n            .on('click', '.do-api-capture', this.do_api_capture.bind(this))\n            .on('click', '.do-api-cancel', this.do_api_cancel.bind(this))\n            .on('click', '.sswps-pay-order', this.open_pay_order_modal.bind(this))\n            .on('change', '#customer_user', this.fetch_payment_methods.bind(this))\n            .on('order-totals-recalculate-success', this.clear_transaction_data.bind(this))\n            .on('keyup', '[name=\"capture_amount\"]', this.validate_capture_amount.bind(this))\n            .on('items_saved', this.clear_transaction_data.bind(this))\n    }\n\n    MetaBox.prototype.clear_transaction_data = function () {\n        $('.do-stripe-transaction-view').data('charge', null);\n    }\n\n    MetaBox.prototype.validate_capture_amount = function (e) {\n        var value = $(e.currentTarget).val();\n        value = parseFloat(value);\n        if (!Number.isNaN(value)) {\n            var data = $('.do-stripe-transaction-view').data('charge');\n            if (data && value < parseFloat(data.order_total)) {\n                if (typeof woocommerce_admin !== 'undefined') {\n                    woocommerce_admin.capture_notice = this.params.messages.capture_amount;\n                    $(document.body).triggerHandler('wc_add_error_tip', [$(e.currentTarget), 'capture_notice']);\n                }\n            } else {\n                $(document.body).triggerHandler('wc_remove_error_tip', [$(e.currentTarget), 'capture_notice']);\n            }\n        }\n    }\n\n    /**\n     * Fetch the charge view data and render the modal.\n     */\n    MetaBox.prototype.render_charge_view = function (e) {\n        e.preventDefault();\n        var $icon = $(e.currentTarget);\n        if (!$icon.data('charge')) {\n            $icon.addClass('disabled');\n            $.when($.ajax({\n                method: 'GET',\n                dataType: 'json',\n                url: this.params.routes.charge_view,\n                data: {\n                    order_id: $icon.data('order'),\n                    _wpnonce: this.params._wpnonce\n                }\n            })).done(function (response) {\n                if (!response.code) {\n                    $icon.data('charge', response.data);\n                    $icon.removeClass('disabled');\n                    $icon.WCBackboneModal({\n                        template: 'sswps-view-transaction',\n                        variable: response.data\n                    });\n                } else {\n                    window.alert(response.message);\n                }\n            }.bind(this)).fail(function (jqXHR, textStatus, errorThrown) {\n                $icon.removeClass('disabled');\n                window.alert(errorThrown);\n            }.bind(this))\n        } else {\n            $icon.WCBackboneModal({\n                template: 'sswps-view-transaction',\n                variable: $icon.data('charge')\n            });\n        }\n    }\n\n    /**\n     *\n     */\n    MetaBox.prototype.do_api_capture = function (e) {\n        e.preventDefault();\n        var $modal = $('.wc-transaction-data');\n        this.block($modal);\n        $.when($.ajax({\n            method: 'POST',\n            dataType: 'json',\n            url: this.params.routes.capture,\n            data: {\n                _wpnonce: this.params._wpnonce,\n                order_id: woocommerce_admin_meta_boxes.post_id,\n                amount: $('[name=\"capture_amount\"]').val()\n            },\n        }).done(function (response) {\n            if (!response.code) {\n                window.location.reload();\n            } else {\n                this.unblock($modal);\n                window.alert(response.message);\n            }\n        }.bind(this))).fail(function (jqXHR, textStatus, errorThrown) {\n            this.unblock($modal);\n            window.alert(errorThrown);\n        }.bind(this));\n    }\n\n    /**\n     *\n     */\n    MetaBox.prototype.do_api_cancel = function (e) {\n        e.preventDefault();\n        var $modal = $('.wc-transaction-data');\n        this.block($modal);\n        $.when($.ajax({\n            method: 'POST',\n            dataType: 'json',\n            url: this.params.routes.void,\n            data: {\n                _wpnonce: this.params._wpnonce,\n                order_id: woocommerce_admin_meta_boxes.post_id\n            },\n        }).done(function (response) {\n            if (!response.code) {\n                window.location.reload();\n            } else {\n                this.unblock($modal);\n                window.alert(response.message);\n            }\n        }.bind(this))).fail(function (jqXHR, textStatus, errorThrown) {\n            this.unblock($modal);\n            window.alert(errorThrown);\n        }.bind(this));\n    }\n\n    MetaBox.prototype.open_pay_order_modal = function (e) {\n        e.preventDefault();\n        $(e.target).WCStripePayOrderBackboneModal({\n            template: 'sswps-modal-pay-order',\n            params: {\n                customer_id: $('#customer_user').val(),\n                payment_methods: sswps_order_pay_params.payment_methods,\n                order_id: $('#post_ID').val()\n            }\n        })\n    }\n\n    MetaBox.prototype.fetch_payment_methods = function (e) {\n        sswps_order_pay_params.payment_methods = [];\n        var customer_id = $('#customer_user').val();\n        if (customer_id) {\n            $.ajax({\n                method: 'GET',\n                dataType: 'json',\n                url: this.params.routes.payment_methods,\n                data: {\n                    _wpnonce: this.params._wpnonce,\n                    customer_id: customer_id\n                }\n            }).done(function (response) {\n                sswps_order_pay_params.payment_methods = response.payment_methods;\n            }.bind(this)).fail(function () {\n\n            }.bind(this))\n        }\n    }\n\n    /**\n     *\n     */\n    MetaBox.prototype.block = function ($el) {\n        $el.block({\n            message: null,\n            overlayCSS: {\n                background: '#fff',\n                opacity: 0.6\n            }\n        });\n    }\n\n    /**\n     *\n     */\n    MetaBox.prototype.unblock = function ($el) {\n        $el.unblock();\n    }\n\n    new MetaBox();\n}(jQuery))"],"names":["$","MetaBox","this","params","sswps_order_metabox_params","initialize","prototype","document","body","on","render_charge_view","bind","do_api_capture","do_api_cancel","open_pay_order_modal","fetch_payment_methods","clear_transaction_data","validate_capture_amount","data","e","value","currentTarget","val","parseFloat","Number","isNaN","order_total","woocommerce_admin","capture_notice","messages","capture_amount","triggerHandler","preventDefault","$icon","WCBackboneModal","template","variable","addClass","when","ajax","method","dataType","url","routes","charge_view","order_id","_wpnonce","done","response","code","window","alert","message","removeClass","fail","jqXHR","textStatus","errorThrown","$modal","block","capture","woocommerce_admin_meta_boxes","post_id","amount","unblock","location","reload","target","WCStripePayOrderBackboneModal","customer_id","payment_methods","sswps_order_pay_params","$el","overlayCSS","background","opacity","jQuery"],"sourceRoot":""}