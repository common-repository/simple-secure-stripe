(()=>{var e;(e=jQuery).fn.WCStripePayOrderBackboneModal=function(n){return this.each((function(){new e.WCStripePayOrderBackboneModal(e(this),n)}))},e.WCStripePayOrderBackboneModal=function(n,a){var t=e.extend({},e.WCBackboneModal.defaultOptions,a);t.template&&new e.WCStripePayOrderBackboneModal.View({target:t.template,string:t.params})},e.WCStripePayOrderBackboneModal.View=e.WCBackboneModal.View.extend({events:_.extend(e.WCBackboneModal.View.prototype.events,{"click #pay-order":"pay_order",'change [name="payment_type"]':"payment_type"}),render:function(){e.WCBackboneModal.View.prototype.render.apply(this,arguments),this.$el.find(".wc-select2").select2(),this.init_card_element(),this.payment_type()},init_card_element:function(){this.stripe=Stripe(sswps_order_pay_params.api_key);var e=this.stripe.elements();this.card=e.create("card",{style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"18px","::placeholder":{color:"#aab7c4"}}},hidePostalCode:!0}),this.card.mount("#card-element")},pay_order:function(n){n.preventDefault(),this.use_token()?this.api_pay_order():this.stripe.createPaymentMethod({type:"card",card:this.card,billing_details:{name:e("#_billing_first_name").val()+" "+e("#_billing_last_name").val(),email:e("#_billing_email").val(),phone:e("#_billing_phone").val(),address:{city:e("#_billing_city").val(),country:e("#_billing_country").val(),line1:e("#_billing_address_1").val(),line2:e("#_billing_address_2").val(),state:e("#_billing_state").val(),postal_code:e("#_billing_postcode").val()}}}).then(function(n){n.error?this.add_messages(n.error.message):(e('[name="payment_nonce"]').val(n.paymentMethod.id),this.api_pay_order())}.bind(this))},api_pay_order:function(){this.block(),e.ajax({url:sswps_order_metabox_params.routes.pay,dataType:"json",method:"POST",data:e("#sswps-pay-order-form").serialize(),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",sswps_order_metabox_params._wpnonce)}}).done(function(e){e.code?(this.unblock(),this.add_messages(e.message)):window.location.href=window.location.href}.bind(this)).fail(function(e,n,a){this.add_messages(a),this.unblock()}.bind(this))},payment_type:function(e){var n=this.$el.find('[name="payment_type"]:checked').val(),a=".show_if_"+n,t=".hide_if_"+n;this.$el.find(a).show(),this.$el.find(t).hide()},block:function(){this.$el.find(".wc-backbone-modal-content").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){this.$el.find(".wc-backbone-modal-content").unblock()},add_messages:function(e){this.$el.find(".woocommerce-error").remove(),-1==e.indexOf("woocommerce-error")&&(e='<div class="woocommerce-error">'+e+"</div>"),this.$el.find("form").prepend(e)},use_token:function(){return"token"===this.$el.find('[name="payment_type"]:checked').val()},set_nonce:function(e){this.$el.find('[name="payment_nonce"]').val(e)}})})();
//# sourceMappingURL=modals.js.map