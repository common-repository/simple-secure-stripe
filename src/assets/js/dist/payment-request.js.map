{"version":3,"file":"payment-request.js","mappings":"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","sources":["webpack://simple-secure-stripe/./src/assets/js/frontend/payment-request.js"],"sourcesContent":["(function ($, sswps) {\n\n    var PaymentRequest;\n\n    // Product page functionality\n    if ($(document.body).is('.single-product')) {\n        /**\n         * [PaymentRequest description]\n         */\n        PaymentRequest = function () {\n            sswps.BaseGateway.call(this, sswps_payment_request_params);\n            window.addEventListener('hashchange', this.hashchange.bind(this));\n            this.old_qty = this.get_quantity();\n        }\n\n        PaymentRequest.prototype = $.extend({}, sswps.BaseGateway.prototype, sswps.ProductGateway.prototype, sswps.PaymentRequest.prototype);\n\n        PaymentRequest.prototype.initialize = function () {\n            if (!$(this.container).length) {\n                return setTimeout(this.initialize.bind(this), 1000);\n            }\n            sswps.ProductGateway.call(this);\n            sswps.PaymentRequest.prototype.initialize.call(this);\n        }\n\n        /**\n         * [canMakePayment description]\n         * @return {[type]} [description]\n         */\n        PaymentRequest.prototype.canMakePayment = function () {\n            sswps.PaymentRequest.prototype.canMakePayment.apply(this, arguments).then(function () {\n                $(document.body).on('change', '[name=\"quantity\"]', this.maybe_calculate_cart.bind(this));\n                $(this.container).parent().parent().addClass('active');\n                if (!this.is_variable_product()) {\n                    this.cart_calculation();\n                } else {\n                    if (this.variable_product_selected()) {\n                        this.cart_calculation();\n                        $(this.container).removeClass('processingFoundVariation');\n                    } else {\n                        this.disable_payment_button();\n                    }\n                }\n            }.bind(this))\n        }\n\n        /**\n         * [add_to_cart description]\n         */\n        PaymentRequest.prototype.maybe_calculate_cart = function (e) {\n            this.disable_payment_button();\n            this.old_qty = this.get_quantity();\n            var variation = this.get_product_data().variation;\n            if (!this.is_variable_product() || this.variable_product_selected()) {\n                this.cart_calculation().then(function () {\n                    if (this.is_variable_product()) {\n                        this.createPaymentRequest();\n                        this.createPaymentRequestButton();\n                        sswps.PaymentRequest.prototype.canMakePayment.apply(this, arguments).then(function () {\n                            this.enable_payment_button();\n                        }.bind(this));\n                    } else {\n                        this.enable_payment_button();\n                    }\n                }.bind(this));\n            }\n        }\n\n        PaymentRequest.prototype.cart_calculation = function () {\n            return sswps.ProductGateway.prototype.cart_calculation.apply(this, arguments).then(function (data) {\n                this.update_from_cart_calculation(data);\n                this.paymentRequest.update(this.get_payment_request_update({\n                    total: {\n                        pending: false\n                    }\n                }));\n            }.bind(this)).catch(function () {\n\n            }.bind(this));\n        }\n\n        PaymentRequest.prototype.create_button = function () {\n            $('#sswps-payment-request-container').empty();\n            sswps.PaymentRequest.prototype.create_button.apply(this, arguments);\n            this.$button = $('#sswps-payment-request-container');\n        }\n\n        PaymentRequest.prototype.button_click = function (e) {\n            if (this.$button.is('.disabled')) {\n                e.preventDefault();\n            } else if (this.get_quantity() == 0) {\n                e.preventDefault();\n                this.submit_error(this.params.messages.invalid_amount);\n            } else {\n                if (!this.needs_shipping()) {\n                    this.add_to_cart();\n                }\n            }\n        }\n\n        PaymentRequest.prototype.found_variation = function () {\n            sswps.ProductGateway.prototype.found_variation.apply(this, arguments);\n            if (this.can_pay) {\n                this.maybe_calculate_cart();\n            }\n        }\n\n        /**\n         * [block description]\n         * @return {[type]} [description]\n         */\n        PaymentRequest.prototype.block = function () {\n            $.blockUI({\n                message: this.adding_to_cart ? this.params.messages.add_to_cart : null,\n                overlayCSS: {\n                    background: '#fff',\n                    opacity: 0.6\n                }\n            });\n        }\n\n    }\n\n    // Cart page functionality\n    if ($(document.body).is('.woocommerce-cart')) {\n        /**\n         * [PaymentRequest description]\n         */\n        PaymentRequest = function () {\n            sswps.BaseGateway.call(this, sswps_payment_request_params);\n            window.addEventListener('hashchange', this.hashchange.bind(this));\n        }\n\n        PaymentRequest.prototype = $.extend({}, sswps.BaseGateway.prototype, sswps.CartGateway.prototype, sswps.PaymentRequest.prototype);\n\n        PaymentRequest.prototype.initialize = function () {\n            sswps.CartGateway.call(this);\n            sswps.PaymentRequest.prototype.initialize.call(this);\n        }\n\n        PaymentRequest.prototype.canMakePayment = function () {\n            sswps.PaymentRequest.prototype.canMakePayment.apply(this, arguments).then(function () {\n                $(this.container).addClass('active').parent().addClass('active');\n            }.bind(this))\n        }\n\n        /**\n         * [updated_html description]\n         * @return {[type]} [description]\n         */\n        PaymentRequest.prototype.updated_html = function () {\n            if (!$(this.container).length) {\n                this.can_pay = false;\n            }\n            if (this.can_pay) {\n                this.initialize();\n            }\n        }\n\n        PaymentRequest.prototype.button_click = function (e) {\n            this.paymentRequest.update(this.get_payment_request_update({\n                total: {\n                    pending: false\n                }\n            }));\n        }\n\n        /**\n         * Called when the cart has been emptied\n         * @param  {[type]} e [description]\n         * @return {[type]}   [description]\n         */\n        PaymentRequest.prototype.cart_emptied = function (e) {\n            this.can_pay = false;\n        }\n    }\n\n    // Checkout page functionality\n    if ($(document.body).is('.woocommerce-checkout')) {\n        /**\n         * [PaymentRequest description]\n         */\n        PaymentRequest = function () {\n            sswps.BaseGateway.call(this, sswps_payment_request_params);\n            window.addEventListener('hashchange', this.hashchange.bind(this));\n        }\n\n        PaymentRequest.prototype = $.extend({}, sswps.BaseGateway.prototype, sswps.CheckoutGateway.prototype, sswps.PaymentRequest.prototype);\n\n        PaymentRequest.prototype.initialize = function () {\n            sswps.CheckoutGateway.call(this);\n            $('form.checkout').on('change', '.form-row:not(.address-field) .input-text', this.update_payment_request.bind(this));\n            if ($(this.container).length) {\n                sswps.PaymentRequest.prototype.initialize.call(this);\n            }\n        }\n        /**\n         * [canMakePayment description]\n         * @return {[type]} [description]\n         */\n        PaymentRequest.prototype.canMakePayment = function () {\n            sswps.PaymentRequest.prototype.canMakePayment.apply(this, arguments).then(function () {\n                this.show_icons();\n                if (this.banner_enabled()) {\n                    $(this.banner_container).empty().show().append('<div id=\"sswps-payment-request-banner\"></div>');\n                    $(this.banner_container).show().addClass('active').closest('.sswps-banner-checkout').addClass('active');\n                    var elements = this.stripe.elements();\n                    var button = elements.create(\"paymentRequestButton\", {\n                        paymentRequest: this.paymentRequest,\n                        style: {\n                            paymentRequestButton: {\n                                type: this.params.button.type,\n                                theme: this.params.button.theme,\n                                height: this.params.button.height\n                            }\n                        }\n                    });\n                    button.on('click', this.banner_checkout.bind(this));\n                    button.mount(\"#sswps-payment-request-banner\");\n                }\n            }.bind(this))\n        }\n\n        /**\n         * [create_button description]\n         * @return {[type]} [description]\n         */\n        PaymentRequest.prototype.create_button = function () {\n            if (this.$button) {\n                this.$button.remove();\n            }\n            this.$button = $('<div id=\"sswps-payment-request-container\"></div>');\n            $('#place_order').after(this.$button);\n            sswps.PaymentRequest.prototype.create_button.call(this);\n            this.trigger_payment_method_selected();\n        }\n\n        /**\n         * [updated_checkout description]\n         * @return {[type]} [description]\n         */\n        PaymentRequest.prototype.updated_checkout = function () {\n            if ($(this.container).length) {\n                sswps.PaymentRequest.prototype.initialize.call(this);\n            }\n        }\n\n        /**\n         * [button_click description]\n         * @param  {[type]} e [description]\n         * @return {[type]}   [description]\n         */\n        PaymentRequest.prototype.banner_checkout = function (e) {\n            this.set_payment_method(this.gateway_id);\n            this.set_use_new_option(true);\n            $('[name=\"terms\"]').prop('checked', true);\n        }\n\n        PaymentRequest.prototype.on_token_received = function () {\n            sswps.CheckoutGateway.prototype.on_token_received.apply(this, arguments);\n            this.fields.toFormFields();\n            if (this.payment_request_options.requestShipping) {\n                this.maybe_set_ship_to_different();\n            }\n            if (this.checkout_fields_valid()) {\n                this.get_form().trigger('submit');\n            }\n        }\n\n        PaymentRequest.prototype.update_payment_request = function () {\n            if ($(this.container).length) {\n                sswps.PaymentRequest.prototype.initialize.call(this);\n            }\n        }\n\n        PaymentRequest.prototype.show_icons = function () {\n            if ($(this.container).length) {\n                $(this.container).find('.sswps-paymentRequest-icon.gpay').show();\n            }\n        }\n    }\n\n    new PaymentRequest();\n\n}(jQuery, window.sswps))"],"names":["$","sswps","PaymentRequest","jQuery","window","document","body","is","BaseGateway","call","this","sswps_payment_request_params","addEventListener","hashchange","bind","old_qty","get_quantity","prototype","extend","ProductGateway","initialize","container","length","setTimeout","canMakePayment","apply","arguments","then","on","maybe_calculate_cart","parent","addClass","is_variable_product","variable_product_selected","cart_calculation","removeClass","disable_payment_button","e","get_product_data","variation","createPaymentRequest","createPaymentRequestButton","enable_payment_button","data","update_from_cart_calculation","paymentRequest","update","get_payment_request_update","total","pending","create_button","empty","$button","button_click","preventDefault","submit_error","params","messages","invalid_amount","needs_shipping","add_to_cart","found_variation","can_pay","block","blockUI","message","adding_to_cart","overlayCSS","background","opacity","CartGateway","updated_html","cart_emptied","CheckoutGateway","update_payment_request","show_icons","banner_enabled","banner_container","show","append","closest","button","stripe","elements","create","style","paymentRequestButton","type","theme","height","banner_checkout","mount","remove","after","trigger_payment_method_selected","updated_checkout","set_payment_method","gateway_id","set_use_new_option","prop","on_token_received","fields","toFormFields","payment_request_options","requestShipping","maybe_set_ship_to_different","checkout_fields_valid","get_form","trigger","find"],"sourceRoot":""}