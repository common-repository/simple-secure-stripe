!function(a){function t(){this.params=sswps_order_metabox_params,this.initialize()}"undefined"!=typeof sswps_order_metabox_params&&(t.prototype.initialize=function(){a(document.body).on("click",".do-stripe-transaction-view",this.render_charge_view.bind(this)).on("click",".do-api-capture",this.do_api_capture.bind(this)).on("click",".do-api-cancel",this.do_api_cancel.bind(this)).on("click",".sswps-pay-order",this.open_pay_order_modal.bind(this)).on("change","#customer_user",this.fetch_payment_methods.bind(this)).on("order-totals-recalculate-success",this.clear_transaction_data.bind(this)).on("keyup",'[name="capture_amount"]',this.validate_capture_amount.bind(this)).on("items_saved",this.clear_transaction_data.bind(this))},t.prototype.clear_transaction_data=function(){a(".do-stripe-transaction-view").data("charge",null)},t.prototype.validate_capture_amount=function(t){var e=a(t.currentTarget).val();if(e=parseFloat(e),!Number.isNaN(e)){var o=a(".do-stripe-transaction-view").data("charge");o&&e<parseFloat(o.order_total)?"undefined"!=typeof woocommerce_admin&&(woocommerce_admin.capture_notice=this.params.messages.capture_amount,a(document.body).triggerHandler("wc_add_error_tip",[a(t.currentTarget),"capture_notice"])):a(document.body).triggerHandler("wc_remove_error_tip",[a(t.currentTarget),"capture_notice"])}},t.prototype.render_charge_view=function(t){t.preventDefault();var e=a(t.currentTarget);e.data("charge")?e.WCBackboneModal({template:"sswps-view-transaction",variable:e.data("charge")}):(e.addClass("disabled"),a.when(a.ajax({method:"GET",dataType:"json",url:this.params.routes.charge_view,data:{order_id:e.data("order"),_wpnonce:this.params._wpnonce}})).done(function(a){a.code?window.alert(a.message):(e.data("charge",a.data),e.removeClass("disabled"),e.WCBackboneModal({template:"sswps-view-transaction",variable:a.data}))}.bind(this)).fail(function(a,t,o){e.removeClass("disabled"),window.alert(o)}.bind(this)))},t.prototype.do_api_capture=function(t){t.preventDefault();var e=a(".wc-transaction-data");this.block(e),a.when(a.ajax({method:"POST",dataType:"json",url:this.params.routes.capture,data:{_wpnonce:this.params._wpnonce,order_id:woocommerce_admin_meta_boxes.post_id,amount:a('[name="capture_amount"]').val()}}).done(function(a){a.code?(this.unblock(e),window.alert(a.message)):window.location.reload()}.bind(this))).fail(function(a,t,o){this.unblock(e),window.alert(o)}.bind(this))},t.prototype.do_api_cancel=function(t){t.preventDefault();var e=a(".wc-transaction-data");this.block(e),a.when(a.ajax({method:"POST",dataType:"json",url:this.params.routes.void,data:{_wpnonce:this.params._wpnonce,order_id:woocommerce_admin_meta_boxes.post_id}}).done(function(a){a.code?(this.unblock(e),window.alert(a.message)):window.location.reload()}.bind(this))).fail(function(a,t,o){this.unblock(e),window.alert(o)}.bind(this))},t.prototype.open_pay_order_modal=function(t){t.preventDefault(),a(t.target).WCStripePayOrderBackboneModal({template:"sswps-modal-pay-order",params:{customer_id:a("#customer_user").val(),payment_methods:sswps_order_pay_params.payment_methods,order_id:a("#post_ID").val()}})},t.prototype.fetch_payment_methods=function(t){sswps_order_pay_params.payment_methods=[];var e=a("#customer_user").val();e&&a.ajax({method:"GET",dataType:"json",url:this.params.routes.payment_methods,data:{_wpnonce:this.params._wpnonce,customer_id:e}}).done(function(a){sswps_order_pay_params.payment_methods=a.payment_methods}.bind(this)).fail(function(){}.bind(this))},t.prototype.block=function(a){a.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},t.prototype.unblock=function(a){a.unblock()},new t)}(jQuery);
//# sourceMappingURL=meta-boxes-order.js.map